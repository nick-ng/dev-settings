## git ##
alias gin='gidefault && git remote prune origin && git pull && git switch -c'

alias giclear='echo "\ngit branch | grep \"^[^*]\" | xargs git branch -d\n"'
alias gipush='git branch | grep "* " | awk "{print \$2}" | xargs git push --set-upstream origin '
alias gitpush='npm test && git branch | grep "* " | awk "{print \$2}" | xargs git push --set-upstream origin '
alias todo="rg '@todo' -n -g '!todo.sh' -g '!package.json' -g '!README.md' | sed 's/:.*@todo/: @todo/m ; s/--*> *$//m ; s/^/- /m ; s/\s\+/ /gm'"

function giap() {
  if [ -f ./todo.sh ]; then
    ./todo.sh
  fi

  git add -N .
  git add -p

  todo
}

function gin2() {
	gidefault
	git remote prune origin
	git pull && git switch -c "$(date '+%Y-%m-%d_%H-%M-%S')"
}

function gidefault() {
  echo "Getting default branch name"
  origin_name=$(git remote show)
  default_branch_name=$(git remote show "$origin_name" | sed -n '/HEAD branch/s/.*: //p')
  echo "Default branch is $default_branch_name"
  git switch $default_branch_name
}

function gipurge() {
  echo "Getting default branch name"
  origin_name=$(git remote show)
  default_branch_name=$(git remote show $origin_name | sed -n '/HEAD branch/s/.*: //p')
  echo "Default branch is $default_branch_name"
  git switch $default_branch_name
  git remote prune $origin_name
  git pull
  git fetch -p
  git branch -vv | grep ": gone]" | awk "{print \$1}" | xargs git branch -D
  echo 'All done'
}

function girebase() {
  echo "Getting default branch name"
  origin_name=$(git remote show)
  default_branch_name=$(git remote show "$origin_name" | sed -n '/HEAD branch/s/.*: //p')
  echo "Default branch is $default_branch_name"
  git switch $default_branch_name
  git remote prune $origin_name
  git pull
  git switch -
  git rebase $default_branch_name
}

## node js ##
alias npmscripts='cat package.json | jq .scripts'
alias nr="npm run"

## dev environment ##
alias cdnvimconf='cd "${XDG_CONFIG_HOME:-$HOME/.config}"/nvim'
function updatealldevsettings() {
		  CURRENT_DIR=$(pwd)
		  cdnvimconf
		  git pull --rebase
		  # change directory to dev-settings
		  cd ~
		  cd "$(readlink ~/.nickrc | sed s/\.nickrc//)" || return
		  git pull --rebase
		  cd "$CURRENT_DIR" || return
}
alias upgradealldevsettings=updatealldevsettings

## tmux ##
# copy tmux buffer to OS buffer
alias tclip='tmux save-buffer - | xclip -selection clipboard'

# Preferred editor for local and remote sessions
if [[ -n $SSH_CONNECTION ]]; then
  export EDITOR='vi'
else
  export EDITOR=$(which nvim)
fi

# set a fancy prompt (non-color, unless we know we "want" color)
case "$TERM" in
    xterm-color|*-256color) color_prompt=yes;;
esac

# uncomment for a colored prompt, if the terminal has the capability; turned
# off by default to not distract the user: the focus in a terminal window
# should be on the output of commands, not on the prompt
#force_color_prompt=yes

if [ -n "$force_color_prompt" ]; then
    if [ -x /usr/bin/tput ] && tput setaf 1 >&/dev/null; then
	# We have color support; assume it's compliant with Ecma-48
	# (ISO/IEC-6429). (Lack of such support is extremely rare, and such
	# a case would tend to support setf rather than setaf.)
	color_prompt=yes
    else
	color_prompt=
    fi
fi

if [ "$color_prompt" = yes ]; then
   # PS1='${debian_chroot:+($debian_chroot)}\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$ '
    PROMPT_COMMAND='PS1_CMD1=$(git branch --show-current 2>/dev/null)'; PS1='\[\e[32m\]${PS1_CMD1}\[\e[0m\] \[\e[34m\]\w\[\e[0m\]$ '
else
    PS1='${debian_chroot:+($debian_chroot)}\u@\h:\w\$ '
fi
unset color_prompt force_color_prompt
